<div class="min-h-screen bg-gray-100 p-4 sm:p-6 lg:p-8 flex flex-col items-center">
  <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-4xl">
    <h2 class="text-3xl font-bold text-gray-900 mb-6 text-center">
      {{ isEditMode ? 'Editar Restaurante' : 'Agregar Nuevo Restaurante' }}
    </h2>

    <form [formGroup]="restaurantForm" (ngSubmit)="onSubmit()" class="space-y-6">
      <div>
        <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Nombre del Restaurante</label>
        <input
          id="name"
          type="text"
          formControlName="name"
          class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
          placeholder="Ej: La Esquina del Sabor"
        >
        <div *ngIf="restaurantForm.get('name')?.invalid && (restaurantForm.get('name')?.dirty || restaurantForm.get('name')?.touched)" class="text-red-600 text-xs mt-1">
          <div *ngIf="restaurantForm.get('name')?.errors?.['required']">El nombre es obligatorio.</div>
          <div *ngIf="restaurantForm.get('name')?.errors?.['maxlength']">El nombre no puede exceder 100 caracteres.</div>
        </div>
      </div>

      <div>
        <label for="imageUrl" class="block text-sm font-medium text-gray-700 mb-1">URL de la Imagen</label>
        <input
          id="imageUrl"
          type="url"
          formControlName="imageUrl"
          class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
          placeholder="Ej: https://ejemplo.com/imagen.jpg"
        >
        <div *ngIf="restaurantForm.get('imageUrl')?.invalid && (restaurantForm.get('imageUrl')?.dirty || restaurantForm.get('imageUrl')?.touched)" class="text-red-600 text-xs mt-1">
          <div *ngIf="restaurantForm.get('imageUrl')?.errors?.['required']">La URL de la imagen es obligatoria.</div>
          <div *ngIf="restaurantForm.get('imageUrl')?.errors?.['pattern']">Por favor ingrese una URL válida (ej: https://...).</div>
        </div>
      </div>

      <div>
        <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Descripción (Opcional)</label>
        <textarea
          id="description"
          formControlName="description"
          rows="3"
          class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
          placeholder="Ej: Un lugar acogedor con la mejor comida casera..."
        ></textarea>
        <div *ngIf="restaurantForm.get('description')?.errors?.['maxlength'] && (restaurantForm.get('description')?.dirty || restaurantForm.get('description')?.touched)" class="text-red-600 text-xs mt-1">
          La descripción no puede exceder 500 caracteres.
        </div>
      </div>

      <fieldset formGroupName="address" class="border border-gray-200 p-4 rounded-md">
        <legend class="text-lg font-semibold text-gray-800 mb-4">Ubicación</legend>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label for="province" class="block text-sm font-medium text-gray-700 mb-1">Provincia</label>
            <select
              id="province"
              formControlName="province"
              class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"
            >
              <option [ngValue]="null" disabled>Seleccione una provincia</option>
              <option *ngFor="let province of allProvinces" [ngValue]="province.id">{{ province.nombre }}</option>
            </select>
            <div *ngIf="restaurantForm.get('address.province')?.invalid && (restaurantForm.get('address.province')?.dirty || restaurantForm.get('address.province')?.touched)" class="text-red-600 text-xs mt-1">
              <div *ngIf="restaurantForm.get('address.province')?.errors?.['required']">La provincia es obligatoria.</div>
            </div>
          </div>

          <div>
            <label for="city" class="block text-sm font-medium text-gray-700 mb-1">Ciudad</label>
            <select
              id="city"
              formControlName="city"
              class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"
              [disabled]="!restaurantForm.get('address.province')?.value || filteredMunicipalities.length === 0"
            >
              <option [ngValue]="null" disabled>Seleccione una ciudad</option>
              <option *ngFor="let municipality of filteredMunicipalities" [ngValue]="municipality.id">{{ municipality.nombre }}</option>
            </select>
            <div *ngIf="restaurantForm.get('address.city')?.invalid && (restaurantForm.get('address.city')?.dirty || restaurantForm.get('address.city')?.touched)" class="text-red-600 text-xs mt-1">
              <div *ngIf="restaurantForm.get('address.city')?.errors?.['required']">La ciudad es obligatoria.</div>
            </div>
          </div>

          <div>
            <label for="street" class="block text-sm font-medium text-gray-700 mb-1">Calle</label>
            <input
              id="street"
              type="text"
              formControlName="street"
              class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
              placeholder="Ej: Av. Rivadavia"
            >
            <div *ngIf="restaurantForm.get('address.street')?.invalid && (restaurantForm.get('address.street')?.dirty || restaurantForm.get('address.street')?.touched)" class="text-red-600 text-xs mt-1">
              <div *ngIf="restaurantForm.get('address.street')?.errors?.['required']">La calle es obligatoria.</div>
              <div *ngIf="restaurantForm.get('address.street')?.errors?.['maxlength']">La calle no puede exceder 100 caracteres.</div>
            </div>
          </div>

          <div>
            <label for="number" class="block text-sm font-medium text-gray-700 mb-1">Número</label>
            <input
              id="number"
              type="text"
              formControlName="number"
              class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
              placeholder="Ej: 1234"
            >
            <div *ngIf="restaurantForm.get('address.number')?.invalid && (restaurantForm.get('address.number')?.dirty || restaurantForm.get('address.number')?.touched)" class="text-red-600 text-xs mt-1">
              <div *ngIf="restaurantForm.get('address.number')?.errors?.['required']">El número es obligatorio.</div>
              <div *ngIf="restaurantForm.get('address.number')?.errors?.['pattern']">El número debe ser un valor numérico.</div>
              <div *ngIf="restaurantForm.get('address.number')?.errors?.['maxlength']">El número no puede exceder 20 caracteres.</div>
            </div>
          </div>

          <!-- ELIMINADO: Piso/Depto (Opcional) -->
          </div>

        <input type="hidden" formControlName="latitude">
        <input type="hidden" formControlName="longitude">

        <div class="mt-6">
          <label class="block text-sm font-medium text-gray-700 mb-2">Seleccione ubicación en el mapa</label>
          <div class="w-full h-64 sm:h-72 md:h-80 lg:h-96 xl:h-100 rounded-md overflow-hidden border border-gray-300 aspect-square">
            <app-location-picker
              (locationSelected)="onLocationSelected($event)"
            ></app-location-picker>
          </div>
          <div *ngIf="restaurantForm.get('address.latitude')?.invalid && (restaurantForm.get('address.latitude')?.dirty || restaurantForm.get('address.latitude')?.touched)" class="text-red-600 text-xs mt-1">
            <div *ngIf="restaurantForm.get('address.latitude')?.errors?.['required']">Debe seleccionar una ubicación en el mapa.</div>
          </div>
        </div>
      </fieldset>

      <div *ngIf="isLoading" class="text-center mt-4">
        <app-loading-spinner></app-loading-spinner>
      </div>

      <div *ngIf="successMessage" class="mt-4 p-3 rounded-md bg-green-100 text-green-700">
        {{ successMessage }}
      </div>

      <div *ngIf="errorMessage" class="mt-4 p-3 rounded-md bg-red-100 text-red-700">
        {{ errorMessage }}
      </div>

      <div class="flex justify-end space-x-3 mt-6">
        <button
          type="button"
          (click)="onCancel()"
          class="px-5 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
        >
          Cancelar
        </button>
        <button
          type="submit"
          class="px-5 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
          [disabled]="restaurantForm.invalid || isLoading"
        >
          {{ isEditMode ? 'Guardar Cambios' : 'Agregar Restaurante' }}
        </button>
      </div>
    </form>
  </div>
</div>
